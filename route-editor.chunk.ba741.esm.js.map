{"version":3,"sources":["webpack:///./routes/editor/index.tsx","webpack:///../../src/index.ts","webpack:///../node_modules/use-hash-state/lib/use-hash-state.js","webpack:///../node_modules/use-hash-state/lib/utils.js"],"names":["PolynumberCodeEditor","props","ref","createRef","class","onInput","e","HTMLTextAreaElement","code","PolynumberEditor","state","setStateAtKey","useHashState","console","log","type","debounce","func","waitMilliseconds","options","nextInvokeTimeout","maxWait","timeSinceLastInvocation","Date","now","lastInvokeTime","timeoutId","isImmediate","debouncedFunction","args","context","this","invokeFunction","apply","shouldCallNow","clearTimeout","setTimeout","cancel","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","defineProperty","exports","value","react_1","require","ts_debounce_1","utils_1","DEFAULT_OPTIONS","usePushState","validateKeysAndTypes","parseStateFromUrl","validator","window","hash","location","slice","obj","JSON","parse","decodeURIComponent","warn","writeStateToUrl","newState","json","stringify","title","document","url","pathname","encodeURIComponent","history","pushState","undefined","replaceState","buildValidator","initialState","customValidator","validators","push","initialStateKeys","Set","keys","initialStateTypes","key","dict","setsAreEqual","objKeys","getKeysAndTypesValidator","every","v","default","initialValidator","_a","_b","_c","didRender","useRef","current","parsedState","validatorRef","_d","useState","setState","useEffect","onHashChange","addEventListener","removeEventListener","prevState","setA","setB","size","diff","forEach","item","delete"],"mappings":"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","file":"route-editor.chunk.ba741.esm.js","sourcesContent":["import { createRef, FunctionalComponent, h } from 'preact'\n// import { Link } from 'preact-router'\n// import { useState } from 'preact/hooks'\nimport Helmet from 'react-helmet'\nimport useHashState from 'use-hash-state'\n\n// type ParseSequenceFunction = (sequence: string) => BeepSequence\n// type SetSequenceFunction = (sequence: BeepSequence) => void\n// type SetStatusFunction = (status: string) => void\n\ninterface CodeEditorProps {\n  code: string;\n}\n\nconst PolynumberCodeEditor: FunctionalComponent<CodeEditorProps> = (props: CodeEditorProps) => {\n  const ref = createRef()\n  const handleInput = (e: Event): void => {\n    if (e.target instanceof HTMLTextAreaElement) {\n      // const sequence = props.parseSequence(e.target.value)\n      // props.setSequence(sequence)\n      // props.setStatus('Nice polynumber')\n    }\n  }\n\n  return (\n    <div ref={ref}>\n      <textarea class=\"alert alert-dark w-100 font-monospace\" onInput={handleInput}>{props.code}</textarea>\n    </div>\n  )\n}\n\nconst PolynumberEditor: FunctionalComponent = () => {\n  const ref = createRef<HTMLElement>()\n  const initialHashState = {0: ''}\n  const {state, setStateAtKey} = useHashState(initialHashState)\n  console.log(state, setStateAtKey)\n  // const initialSequence = state[0].length ? parseBeepHash(state[0]) : new BeepSequence([])\n  // const [sequence, setSequence] = useState(initialSequence)\n  // const [status, setStatus] = useState('Ready to beep')\n  // const [GRUBCode, setGRUBCode] = useState(initialSequence.toGRUBInitTune())\n  // const [beepCode, setBeepCode] = useState(initialSequence.toBeepCommand())\n  // const handlePlayClick = (): void => {\n  //   playBeepSequence(sequence)\n  // }\n  // const handleGRUBCodeUpdate = (sequence: BeepSequence): void => {\n  //   setSequence(sequence)\n  //   setStateAtKey(0, sequence.toHash())\n  //   setBeepCode(sequence.toBeepCommand())\n  // }\n  // const handleBeepCodeUpdate = (sequence: BeepSequence): void => {\n  //   setSequence(sequence)\n  //   setStateAtKey(0, sequence.toHash())\n  //   setGRUBCode(sequence.toGRUBInitTune())\n  // }\n\n  return (\n    <section class=\"container py-5\" ref={ref}>\n      <Helmet><title>Polynumber Editor</title></Helmet>\n\n      <h1>Polynumber Editor</h1>\n\n      <PolynumberCodeEditor code=\"koad\" />\n\n      <button type=\"button\" class=\"btn btn-success float-end\">Go?</button>\n\n      <h2>Status</h2>\n      <p>poly</p>\n\n    </section>\n  )\n}\n\nexport default PolynumberEditor\n","/**\n * A function that emits a side effect and does not return anything.\n */\nexport type Procedure = (...args: any[]) => void;\n\nexport type Options = {\n  isImmediate?: boolean;\n  maxWait?: number;\n};\n\nexport interface DebouncedFunction<F extends Procedure> {\n  (this: ThisParameterType<F>, ...args: Parameters<F>): void;\n  cancel: () => void;\n}\n\nexport function debounce<F extends Procedure>(\n  func: F,\n  waitMilliseconds = 50,\n  options: Options = {}\n): DebouncedFunction<F> {\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\n  const isImmediate = options.isImmediate ?? false;\n  const maxWait = options.maxWait;\n  let lastInvokeTime = Date.now();\n\n  function nextInvokeTimeout() {\n    if (maxWait !== undefined) {\n      const timeSinceLastInvocation = Date.now() - lastInvokeTime;\n\n      if (timeSinceLastInvocation + waitMilliseconds >= maxWait) {\n        return maxWait - timeSinceLastInvocation;\n      }\n    }\n\n    return waitMilliseconds;\n  }\n\n  const debouncedFunction = function (\n    this: ThisParameterType<F>,\n    ...args: Parameters<F>\n  ) {\n    const context = this;\n\n    const invokeFunction = function () {\n      timeoutId = undefined;\n      lastInvokeTime = Date.now();\n      if (!isImmediate) {\n        func.apply(context, args);\n      }\n    };\n\n    const shouldCallNow = isImmediate && timeoutId === undefined;\n\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = setTimeout(invokeFunction, nextInvokeTimeout());\n\n    if (shouldCallNow) {\n      func.apply(context, args);\n    }\n  };\n\n  debouncedFunction.cancel = function () {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n    }\n  };\n\n  return debouncedFunction;\n}\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nvar ts_debounce_1 = require(\"ts-debounce\");\nvar utils_1 = require(\"./utils\");\nvar DEFAULT_OPTIONS = {\n    usePushState: false,\n    validateKeysAndTypes: true,\n};\nvar DEBOUNCE_WRITE_URL_MS = 100;\nvar parseStateFromUrl = function (validator) {\n    if (typeof window === 'undefined') {\n        return;\n    }\n    var hash = window.location.hash.slice(1);\n    if (!hash) {\n        return;\n    }\n    try {\n        var obj = JSON.parse(decodeURIComponent(hash));\n        if (!obj) {\n            return;\n        }\n        if (validator) {\n            if (validator(obj)) {\n                return obj;\n            }\n            else {\n                console.warn('Object in URL hash is invalid, ignoring');\n                console.warn(obj);\n            }\n        }\n        else {\n            return obj;\n        }\n    }\n    catch (e) {\n        console.warn('URL hash is not valid JSON, ignoring');\n        // JSON parsing failed\n    }\n    return undefined;\n};\nvar writeStateToUrl = ts_debounce_1.debounce(function (newState, usePushState) {\n    if (usePushState === void 0) { usePushState = false; }\n    if (typeof window === 'undefined') {\n        return;\n    }\n    var json = JSON.stringify(newState);\n    var title = document.title;\n    var url = window.location.pathname + \"#\" + encodeURIComponent(json);\n    if (usePushState) {\n        window.history.pushState(undefined, title, url);\n    }\n    else {\n        window.history.replaceState(undefined, title, url);\n    }\n}, DEBOUNCE_WRITE_URL_MS);\nvar getKeysAndTypesValidator = function (initialState) {\n    var initialStateKeys = new Set(Object.keys(initialState));\n    var initialStateTypes = {};\n    for (var key in initialState) {\n        initialStateTypes[key] = typeof initialState[key];\n    }\n    return function (obj) {\n        if (typeof obj !== 'object' || obj === null) {\n            return false;\n        }\n        var dict = obj;\n        if (!utils_1.setsAreEqual(initialStateKeys, new Set(Object.keys(dict)))) {\n            return false;\n        }\n        var objKeys = Object.keys(dict);\n        for (var i = 0; i < objKeys.length; i++) {\n            var key = objKeys[i];\n            var value = dict[key];\n            var keyType = typeof value;\n            if (keyType !== initialStateTypes[key]) {\n                return false;\n            }\n        }\n        return true;\n    };\n};\nvar buildValidator = function (initialState, validateKeysAndTypes, customValidator) {\n    var validators = [];\n    if (validateKeysAndTypes) {\n        validators.push(getKeysAndTypesValidator(initialState));\n    }\n    if (customValidator) {\n        validators.push(customValidator);\n    }\n    return function (obj) { return validators.every(function (v) { return v(obj); }); };\n};\nvar useHashState = function (initialState, options) {\n    var _a = __assign(__assign({}, DEFAULT_OPTIONS), options), _b = _a.usePushState, usePushState = _b === void 0 ? false : _b, _c = _a.validateKeysAndTypes, validateKeysAndTypes = _c === void 0 ? true : _c, customValidator = _a.customValidator;\n    var didRender = react_1.useRef(false);\n    var initialValidator;\n    if (!didRender.current) {\n        initialValidator = buildValidator(initialState, validateKeysAndTypes, customValidator);\n        // Synchronously check the URL hash on the first render,\n        // so that the state returned to the caller is the URL state\n        // if one is defined.\n        var parsedState = parseStateFromUrl(initialValidator);\n        if (parsedState) {\n            initialState = parsedState;\n        }\n        else if (initialState) {\n            writeStateToUrl(initialState, usePushState);\n        }\n        didRender.current = true;\n    }\n    var validatorRef = react_1.useRef(initialValidator);\n    var _d = react_1.useState(initialState), state = _d[0], setState = _d[1];\n    react_1.useEffect(function () {\n        validatorRef.current = buildValidator(initialState, validateKeysAndTypes, customValidator);\n    }, [initialState, validateKeysAndTypes, customValidator]);\n    var onHashChange = function () {\n        var parsedState = parseStateFromUrl(validatorRef.current);\n        if (parsedState) {\n            setState(parsedState);\n        }\n    };\n    react_1.useEffect(function () {\n        window.addEventListener('hashchange', onHashChange);\n        return function () {\n            window.removeEventListener('hashchange', onHashChange);\n        };\n    }, []);\n    var setStateAtKey = function (key, value) {\n        setState(function (prevState) {\n            var _a;\n            var newState = __assign(__assign({}, prevState), (_a = {}, _a[key] = value, _a));\n            writeStateToUrl(newState, usePushState);\n            return newState;\n        });\n    };\n    return { state: state, setStateAtKey: setStateAtKey };\n};\nexports.default = useHashState;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setsAreEqual = function (setA, setB) {\n    if (setA.size !== setB.size) {\n        return false;\n    }\n    var diff = new Set(setB);\n    setA.forEach(function (item) {\n        diff.delete(item);\n    });\n    return diff.size === 0;\n};\n"],"sourceRoot":""}